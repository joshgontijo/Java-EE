<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

	<!-- Credential -->
	<changeSet author="josue" id="lottery-changeset-1">
		<createTable tableName="credential">
			<column name="uuid" type="VARCHAR(255)">
				<constraints primaryKey="true" />
			</column>
			<column name="date_created" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>
			<column name="date_updated" type="TIMESTAMP" />
			<column name="password" type="VARCHAR(255)">
				<constraints nullable="false" />
			</column>
			<column name="access_level" type="VARCHAR(255)">
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>

	<!-- User -->
	<changeSet author="josue" id="lottery-changeset-2">
		<createTable tableName="user">
			<column name="uuid" type="VARCHAR(255)">
				<constraints primaryKey="true" />
			</column>
			<column name="date_created" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>
			<column name="date_updated" type="TIMESTAMP" />
			<column name="email" type="VARCHAR(255)">
				<constraints nullable="false" />
			</column>
			<column name="first_name" type="VARCHAR(255)" />
			<column name="last_name" type="VARCHAR(255)" />
			<column name="credential_uuid" type="VARCHAR(255)">
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>

	<changeSet author="josue" id="lottery-changeset-3">
		<addUniqueConstraint columnNames="email"
			constraintName="unique_email" tableName="user" />
	</changeSet>

	<changeSet author="josue" id="lottery-changeset-4">
		<addForeignKeyConstraint baseColumnNames="credential_uuid"
			baseTableName="user" constraintName="fk_user_credential"
			referencedColumnNames="uuid" referencedTableName="credential" />
	</changeSet>

	<!-- lotto -->
	<changeSet author="josue" id="lottery-changeset-5">
		<createTable tableName="lotto">
			<column name="uuid" type="VARCHAR(255)">
				<constraints primaryKey="true" />
			</column>
			<column name="date_created" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>
			<column name="date_updated" type="TIMESTAMP" />
			<column name="draw_date" type="DATETIME" />
			<column name="draw_id" type="INT(11)">
				<constraints nullable="false" />
			</column>
			<column name="lotto_type" type="INT(11)">
				<constraints nullable="false" />
			</column>
			<column name="next_draw_rating" type="DOUBLE" />
			<column name="jackpot_value" type="DOUBLE" />
			<column name="total_amount" type="DOUBLE" />
		</createTable>
	</changeSet>

	<changeSet author="josue" id="lottery-changeset-6">
		<addUniqueConstraint columnNames="draw_id, lotto_type"
			constraintName="unique_drawId_lottoType" tableName="lotto" />
	</changeSet>

	<!-- draw -->
	<changeSet author="josue" id="lottery-changeset-7">
		<createTable tableName="draw">
			<column name="uuid" type="VARCHAR(255)">
				<constraints primaryKey="true" />
			</column>
			<column name="date_created" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>
			<column name="date_updated" type="TIMESTAMP" />
			<column name="draw_description" type="VARCHAR(255)" />
			<column name="draw_value" type="INT(11)" />
			<column name="lotto_uuid" type="VARCHAR(255)" />
		</createTable>
	</changeSet>

	<changeSet author="josue" id="lottery-changeset-8">
		<addForeignKeyConstraint baseColumnNames="lotto_uuid"
			baseTableName="draw" constraintName="fk_draw_lotto"
			referencedColumnNames="uuid" referencedTableName="lotto" />
	</changeSet>

	<!-- winners -->
	<changeSet author="josue" id="lottery-changeset-9">
		<createTable tableName="winners">
			<column name="uuid" type="VARCHAR(255)">
				<constraints primaryKey="true" />
			</column>
			<column name="date_created" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>
			<column name="date_updated" type="TIMESTAMP" />
			<column name="winners_count" type="INT(11)" />
			<column name="winners_description" type="VARCHAR(255)" />
			<column name="winners_prizes" type="DOUBLE" />
			<column name="lotto_uuid" type="VARCHAR(255)" />
		</createTable>
	</changeSet>

	<changeSet author="josue" id="lottery-changeset-10">
		<addForeignKeyConstraint baseColumnNames="lotto_uuid"
			baseTableName="winners" constraintName="fk_winners_lotto"
			referencedColumnNames="uuid" referencedTableName="lotto" />
	</changeSet>

	<!-- Lotto criteria search -->
	<changeSet author="josue" id="lottery-changeset-11">
		<createTable tableName="lotto_criteria_search">
			<column name="uuid" type="VARCHAR(255)">
				<constraints primaryKey="true" />
			</column>
			<column name="date_created" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>
			<column name="date_updated" type="TIMESTAMP" />
			<column name="name" type="VARCHAR(255)" />
			<column name="owner_uuid" type="VARCHAR(255)" />
		</createTable>
	</changeSet>

	<changeSet author="josue" id="lottery-changeset-12">
		<addForeignKeyConstraint baseColumnNames="owner_uuid"
			baseTableName="lotto_criteria_search" constraintName="fk_user_lottoCriteriaSearch"
			referencedColumnNames="uuid" referencedTableName="user" />
	</changeSet>

	<!-- Lotto criteria -->
	<changeSet author="josue" id="lottery-changeset-13">
		<createTable tableName="lotto_criteria">
			<column name="uuid" type="VARCHAR(255)">
				<constraints primaryKey="true" />
			</column>
			<column name="date_created" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>
			<column name="date_updated" type="TIMESTAMP" />
			<column name="field_name" type="VARCHAR(255)" />
			<column name="lotto_criteria_search_uuid" type="VARCHAR(255)" />
			<column name="logic_operand" type="INT(11)" />
			<column name="operand_type" type="INT(11)" />
		</createTable>
	</changeSet>

	<changeSet author="josue" id="lottery-changeset-14">
		<createTable tableName="lotto_criteria_values">
			<column name="lotto_criteria_uuid" type="VARCHAR(255)" />
			<column name="field_value" type="VARCHAR(255)">
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>

	<changeSet author="josue" id="lottery-changeset-15">
		<addForeignKeyConstraint baseColumnNames="lotto_criteria_uuid"
			baseTableName="lotto_criteria_values" constraintName="fk_lottocriteria_lottoCriteriaValues"
			referencedColumnNames="uuid" referencedTableName="lotto_criteria" />
	</changeSet>

	<changeSet author="josue" id="lottery-changeset-16">
		<addForeignKeyConstraint baseColumnNames="lotto_criteria_search_uuid"
			baseTableName="lotto_criteria" constraintName="fk_lottoCriteriaSearch_lottoCriteriaValues"
			referencedColumnNames="uuid" referencedTableName="lotto_criteria_search" />
	</changeSet>

</databaseChangeLog>
